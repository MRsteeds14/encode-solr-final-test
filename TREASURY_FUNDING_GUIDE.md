# üí∞ Transfer USDC to New Treasury - Quick Guide

## üîç **Understanding Your Wallets**

You have TWO different addresses:

### **1. Circle Developer Wallet** (Your user wallet)
```
Address: 0x5f02c9D3424F59607d2458D08D89e2D2979657b7
Type: Circle Developer-Controlled Wallet (SCA with Unified Addressing)
Balance: 10,010 USDC
Purpose: Your personal/testing wallet
```

### **2. Old Treasury Contract** (Smart contract)
```
Address: 0x8825518674A89e28d2C11CA0Ec49024ef6e1E2b2
Type: Smart Contract (Treasury.sol)
Balance: Unknown (possibly 0 or has some USDC)
Purpose: Old redemption contract (will be replaced)
```

### **3. New Treasury Contract** (After deployment)
```
Address: Will be generated by redeploy-system.cjs
Type: Smart Contract (Treasury.sol with burn)
Balance: 0 initially (you need to fund it)
Purpose: New redemption contract with burn mechanism
```

---

## üöÄ **Step-by-Step: Complete Deployment + Funding**

### **Phase 1: Deploy New Contracts**

```bash
# 1. Compile contracts
cd contracts && forge build && cd ..

# 2. Deploy new system (SARCToken + Treasury)
node contracts/scripts/redeploy-system.cjs
# Enter your deployer private key when prompted

# Output will show:
# ‚úÖ New SARCToken: 0xNEW_TOKEN_ADDRESS
# ‚úÖ New Treasury: 0xNEW_TREASURY_ADDRESS
```

### **Phase 2: Fund New Treasury**

```bash
# 3. Transfer USDC from Circle wallet to new Treasury
node fund-new-treasury.cjs
# Enter your Circle wallet private key when prompted
# Enter amount: 10010 (or "all")

# This will:
# - Approve Treasury to spend USDC
# - Call fundTreasury() to transfer USDC
# - Verify Treasury received funds
```

### **Phase 3: Verify**

```bash
# 4. Check Treasury balance
NEW_TREASURY=$(grep VITE_TREASURY_ADDRESS .env.local | cut -d'=' -f2)

cast call $NEW_TREASURY \
  "getTreasuryBalance()" \
  --rpc-url https://rpc.testnet.arc.network

# Should return:
# [0, 10010000000000000000000]  (0 sARC, 10010 USDC)
```

---

## ‚ö° **One-Line Complete Setup**

```bash
cd contracts && forge build && cd .. && \
node contracts/scripts/redeploy-system.cjs && \
node fund-new-treasury.cjs
```

---

## üîë **Private Keys You Need**

### **Deployer Private Key** (for redeploy-system.cjs)
- This wallet deploys contracts
- Needs ~2 USDC for gas
- Gets `DEFAULT_ADMIN_ROLE` on all contracts

### **Circle Wallet Private Key** (for fund-new-treasury.cjs)
- This is `0x5f02c9D3424F59607d2458D08D89e2D2979657b7`
- Has the 10,010 USDC balance
- Used to transfer USDC to Treasury

**Note**: These might be the SAME wallet if you deployed from Circle wallet!

---

## üìä **What Happens to Old Treasury?**

### **Old Treasury (`0x8825...2b2`)**
- Will still exist on-chain (can't delete contracts)
- Your frontend will stop using it (after .env.local update)
- Any USDC in it can be withdrawn via `emergencyWithdrawUSDC()`

**Should you withdraw from old Treasury?**
```bash
# Check if old Treasury has USDC
cast call 0x8825518674A89e28d2C11CA0Ec49024ef6e1E2b2 \
  "getTreasuryBalance()" \
  --rpc-url https://rpc.testnet.arc.network

# If it has USDC, withdraw it:
cast send 0x8825518674A89e28d2C11CA0Ec49024ef6e1E2b2 \
  "emergencyWithdrawUSDC(address,uint256)" \
  YOUR_WALLET_ADDRESS \
  AMOUNT \
  --private-key YOUR_DEPLOYER_KEY \
  --rpc-url https://rpc.testnet.arc.network
```

---

## üõ†Ô∏è **Troubleshooting**

### ‚ùå "Transaction reverted: ERC20: insufficient allowance"
**Fix**: Run approve() before fundTreasury()
```bash
cast send 0x3600000000000000000000000000000000000000 \
  "approve(address,uint256)" \
  $NEW_TREASURY \
  10010000000000000000000 \
  --private-key YOUR_CIRCLE_WALLET_KEY \
  --rpc-url https://rpc.testnet.arc.network
```

### ‚ùå "Private key doesn't match Circle wallet"
**Problem**: You entered wrong private key
**Fix**: Check which wallet you used to create `0x5f02c9D3424F59607d2458D08D89e2D2979657b7`

### ‚ùå "Circle wallet has 0 USDC"
**Fix**: Get testnet USDC from faucet
```
https://faucet.circle.com
```

### ‚ùå "fundTreasury() not found"
**Problem**: You're calling old Treasury instead of new one
**Fix**: Verify you deployed new Treasury and .env.local is updated

---

## üìù **Manual Transfer (Alternative)**

If the script doesn't work, you can do it manually:

```bash
# Get addresses
NEW_TREASURY=$(grep VITE_TREASURY_ADDRESS .env.local | cut -d'=' -f2)
CIRCLE_WALLET="0x5f02c9D3424F59607d2458D08D89e2D2979657b7"
USDC="0x3600000000000000000000000000000000000000"

# 1. Approve
cast send $USDC \
  "approve(address,uint256)" \
  $NEW_TREASURY \
  10010000000000000000000 \
  --private-key YOUR_CIRCLE_WALLET_KEY \
  --rpc-url https://rpc.testnet.arc.network

# 2. Fund
cast send $NEW_TREASURY \
  "fundTreasury(uint256)" \
  10010000000000000000000 \
  --private-key YOUR_CIRCLE_WALLET_KEY \
  --rpc-url https://rpc.testnet.arc.network

# 3. Verify
cast call $NEW_TREASURY \
  "getTreasuryBalance()" \
  --rpc-url https://rpc.testnet.arc.network
```

---

## ‚úÖ **Checklist**

Before running scripts:
- [ ] Foundry installed (`forge --version`)
- [ ] Contracts compiled (`cd contracts && forge build`)
- [ ] Have deployer private key (for contract deployment)
- [ ] Have Circle wallet private key (for USDC transfer)
- [ ] Circle wallet has 10,010 USDC
- [ ] Deployer wallet has ~2 USDC for gas

After running scripts:
- [ ] New SARCToken deployed
- [ ] New Treasury deployed
- [ ] Treasury has 10,010 USDC
- [ ] .env.local updated with new addresses
- [ ] Frontend restarted (`npm run dev`)

---

## üéØ **Expected Results**

After complete setup:

```bash
# Check new Treasury has USDC
cast call $NEW_TREASURY "getTreasuryBalance()" --rpc-url https://rpc.testnet.arc.network
# Returns: [0, 10010000000000000000000]
#           ^        ^
#           |        ‚îî‚îÄ 10,010 USDC (18 decimals)
#           ‚îî‚îÄ 0 sARC

# Check Circle wallet sent USDC
cast call $USDC "balanceOf(address)" 0x5f02c9D3424F59607d2458D08D89e2D2979657b7 --rpc-url https://rpc.testnet.arc.network
# Returns: 0 (or remaining balance if you didn't send all)
```

---

## üìû **Support**

If you get stuck:
1. Check transaction on block explorer: https://testnet.arcscan.app
2. Verify contract addresses in .env.local
3. Run: `cast call ADDRESS "FUNCTION()" --rpc-url https://rpc.testnet.arc.network`

---

**Summary**: Your Circle wallet (`0x5f02...7b7`) has the USDC. After deploying new Treasury, run `node fund-new-treasury.cjs` to transfer it there. The script will handle approve + fundTreasury for you!
